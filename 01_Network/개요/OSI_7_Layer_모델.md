## 1. 개요

OSI 7 계층 모델(Open Systems Interconnection model)은 네트워크 통신 과정을 7단계의 논리적 계층으로 표준화한 참조 모델입니다.

---
## 2. 계층별 동작 논리
### 2.1 Layer 1: 물리 계층 (Physical Layer)

데이터를 전기적 신호(0과 1)로 변환하여 물리적 매체를 통해 전송하는 역할을 수행한다. 논리적 데이터가 흐를 수 있는 물리적 기반(Hardware)을 제공한다.

- **PDU (Protocol Data Unit)**: Bit
- **주요 장비**: 케이블(UTP, 광), 리피터, 더미 허브, NIC(랜카드)의 물리적 포트
- **동작 논리**: "두 장비 간에 전기적 신호가 도달할 수 있는가?"

### 2.2 Layer 2: 데이터 링크 계층 (Data Link Layer)

물리적으로 연결된 인접 노드 간의 신뢰성 있는 전송을 보장한다. MAC 주소(물리적 주소)를 기반으로 장비를 식별하며, 물리 계층에서 발생하는 오류를 감지한다.

- **PDU**: Frame
- **주요 장비**: L2 스위치, 브리지
- **주요 프로토콜**: Ethernet, ARP(Address Resolution Protocol)
- **동작 논리**: "같은 네트워크 안에서 다음 장비(Gateway, Switch)까지 데이터를 전달할 수 있는가?"

### 2.3 Layer 3: 네트워크 계층 (Network Layer)

다양한 네트워크 대역을 통과하여 목적지까지의 최적 경로(Routing)를 결정하고, 논리적 주소(IP)를 통해 패킷을 전송한다. End-to-End 통신의 시작점이다.

- **PDU**: Packet
- **주요 장비**: 라우터, L3 스위치
- **주요 프로토콜**: IP, ICMP, IGMP
- **동작 논리**: "서울에서 부산(목적지 서버)까지 가는 경로가 확보되었는가?"

### 2.4 Layer 4: 전송 계층 (Transport Layer)

양 끝단(End-to-End)의 호스트 내에서 실행 중인 **프로세스(Process)**를 식별하고, 데이터 전송의 신뢰성과 흐름을 제어한다. 포트(Port) 번호를 통해 데이터가 어떤 애플리케이션으로 전달되어야 하는지를 결정한다.

- **PDU**: Segment (TCP) / Datagram (UDP)
- **주요 장비**: L4 스위치(로드 밸런서), 방화벽
- **주요 프로토콜**: TCP, UDP
- **동작 논리**: "도착한 패킷이 웹 서버(80)용인가, SSH(22)용인가? 데이터가 유실되지 않았는가?"

### 2.5 Layer 5~7: 상위 계층 (Application Area)

실무적으로는 L5(세션), L6(표현), L7(응용)을 묶어 **애플리케이션 계층**으로 통칭하는 경우가 많다. 사용자가 실제로 상호작용하는 인터페이스와 데이터의 표현 방식을 담당한다.

- **PDU**: Data
- **주요 프로토콜**: HTTP, SSH, FTP, DNS, SMTP
- **동작 논리**: "데이터의 내용은 무엇이며, 사용자는 무엇을 요청했는가?"

---
## 3. 실무 네트워크 트러블슈팅 정리

실무에서의 네트워크 장애 대응은 OSI 계층을 기준으로 문제 범위를 단계적으로 좁혀가는 과정이다.  
특히 클라우드 환경에서는 NAT, 로드밸런서, 보안 그룹 등으로 인해 증상과 실제 원인이 다른 계층에 존재하는 경우가 많아, 계층 단위로 정상/비정상을 명확히 구분하는 접근이 필요하다.

---

### 3.1 Ping은 되는데 SSH / HTTP 접속이 되지 않는 경우

`ping` 응답은 정상이나 `ssh`, `curl` 등 TCP 기반 접속이 실패하는 상황이다.

- **진단**
    
    - `ping`은 ICMP 기반 통신으로, IP 주소와 라우팅 경로(L3)가 정상임을 의미한다.
        
    - 문제 원인은 포트 접근 제어 또는 서비스 상태(L4 이상)에 있을 가능성이 높다.
        
- **점검 항목**
    
    - 방화벽 및 보안 그룹에서 해당 포트(22, 80, 443 등) 인바운드 허용 여부
        
    - 대상 서버에서 해당 포트를 리슨(Listen) 중인 프로세스 존재 여부
        
        - `ss -nltp`, `netstat -nltp`
            
        - 서비스 데몬 상태 확인

---

### 3.2 Connection Refused와 Connection Timed Out의 구분

접속 실패 시 반환되는 에러 메시지를 통해 문제 계층을 구분할 수 있다.

- **Connection Refused**
    
    - 목적지 서버에 도달했으나 해당 포트에서 연결을 수락하지 않음
        
    - 원인
        
        - 서비스 미기동
            
        - 포트 설정 불일치
            
        - 방화벽의 Reject 정책
            
    - 주로 L4~L7 영역 문제
        
- **Connection Timed Out**
    
    - 요청이 중간에서 응답 없이 소멸
        
    - 원인
        
        - 방화벽 DROP 정책
            
        - 보안 그룹 미허용
            
        - NAT 또는 라우팅 설정 문제
            
    - L3~L4 영역 문제 가능성

---

### 3.3 간헐적 연결 끊김 및 세션 만료

일정 시간 이후 연결이 끊기거나 일부 클라이언트에서만 간헐적으로 오류가 발생하는 경우이다.

- **진단**
    
    - 로드밸런서(L4)와 백엔드 서버 간 세션 유지 시간(Keep-Alive, Idle Timeout) 설정 불일치 가능성
        
    - 로드밸런서는 세션을 종료했으나 서버는 연결이 유지된 것으로 판단하여 응답을 전송하는 상황 발생
        
- **점검 항목**
    
    - L4 로드밸런서 세션 타임아웃 설정
        
    - WAS 및 웹 서버의 Keep-Alive 설정

---

### 3.4 IP 접속은 되나 도메인 접속이 되지 않는 경우

IP 직접 접속은 가능하나 도메인 기반 접속이 실패하는 경우이다.

- **진단**
    
    - 네트워크 연결(L1~L4)은 정상
        
    - DNS 해석 과정(L7)에서 문제 발생
        
- **점검 항목**
    
    - DNS 서버 설정 (`/etc/resolv.conf`)
        
    - DNS 서버 접근 가능 여부 (53 포트)
        
    - 클라우드 환경의 VPC DNS 설정

---

### 3.5 클라우드 인프라 환경에서의 추가 고려 사항

클라우드 환경에서는 다음 요소들이 함께 동작한다.

- NAT Gateway 또는 포트 포워딩
    
- 외부 IP에서 내부 IP로의 변환
    
- 인프라 단 방화벽 및 보안 그룹

실무에서는 외부에서 확인되는 증상은 L4 통신 문제처럼 보이지만,  
실제 원인은 NAT 변환 이후 내부 IP 기준의 인바운드/아웃바운드 방화벽 정책인 경우가 많았다.

해당 환경에서는 내부 IP 기준으로 인바운드/아웃바운드 방화벽 규칙을 협력 업체 및 인프라 담당자와 함께 조정하며 문제를 해결하였다.

---

## 4. 계층별 점검 요약

|계층|주요 확인 대상|
|---|---|
|L7|HTTP 상태 코드, 인증/권한, 애플리케이션 로직|
|L6|TLS 인증서, 암호화 설정, 인코딩|
|L4|포트 오픈 여부, 서비스 리스닝 상태, 로드밸런서 세션|
|L3|IP 설정, 라우팅, NAT|
|L2|ARP, MAC 인식|
|L1|네트워크 인터페이스 상태|
