
## 1. 개요

OSI 모델에서 말하는 **캡슐화(Encapsulation)** 와 **디캡슐화(Decapsulation)** 는  
데이터가 네트워크를 통해 **어떻게 포장되어 전달되고, 어떻게 해석되는지**를 설명하는 핵심 개념이다.

각 계층은 **자신의 역할에 필요한 정보만을 헤더(Header)로 추가**하며,  
상위 계층의 데이터 내용에는 관여하지 않는다.

이 구조 덕분에 네트워크 통신은

- 계층별로 독립적인 설계가 가능하고
    
- 문제 발생 시 계층 단위 분석이 가능하다.
    

---

## 2. 캡슐화(Encapsulation)란 무엇인가

캡슐화란 **상위 계층에서 생성된 데이터를 하위 계층으로 전달하면서,  
각 계층이 자신의 제어 정보를 덧붙이는 과정**을 의미한다.

데이터는 송신 측에서 다음 순서로 포장된다.

---

## 3. 송신 과정: 캡슐화 흐름

### 3.1 Application 계층 (L7~L5)

- 사용자가 요청한 실제 데이터 생성
    
- 예: HTTP 요청 메시지
    

이 단계에서는  
“어떤 데이터를 보낼 것인가”만 관심 대상이다.

- **PDU**: Data
    

---

### 3.2 Transport 계층 (L4)

- 포트 번호 추가
    
- 순서 보장, 재전송 여부 결정
    
- TCP 또는 UDP 선택
    

이 계층에서는  
“이 데이터가 어떤 프로세스로 가야 하는가”가 중요하다.

- **PDU**: Segment (TCP) / Datagram (UDP)
    
- **헤더 포함 정보**
    
    - Source Port
        
    - Destination Port
        
    - Sequence / Acknowledgement 번호
        

---

### 3.3 Network 계층 (L3)

- 출발지 / 목적지 IP 주소 추가
    
- 라우팅을 위한 논리적 주소 부여
    

이 단계부터 데이터는 **네트워크를 건너갈 수 있는 단위**가 된다.

- **PDU**: Packet
    
- **헤더 포함 정보**
    
    - Source IP
        
    - Destination IP
        

---

### 3.4 Data Link 계층 (L2)

- MAC 주소 추가
    
- 물리적으로 연결된 다음 장비 식별
    

이 계층은 **같은 네트워크 내 전달**만 책임진다.

- **PDU**: Frame
    
- **헤더 포함 정보**
    
    - Source MAC
        
    - Destination MAC
        
- **트레일러**
    
    - FCS(Frame Check Sequence)
        

---

### 3.5 Physical 계층 (L1)

- 전기적 신호(0과 1)로 변환
    
- 물리 매체를 통해 전송
    
- **PDU**: Bit
    

---

### 3.6 캡슐화 요약 흐름

`[Data]  → [TCP/UDP Header + Data]    → [IP Header + Segment]      → [MAC Header + Packet + FCS]        → Bit Stream`

각 계층은 **자신의 헤더만 신경 쓰고**,  
상위 데이터의 의미는 알지 못한다.

---

## 4. 수신 과정: 디캡슐화 흐름

디캡슐화는 캡슐화의 **정확히 반대 과정**이다.  
수신 측에서는 하위 계층부터 상위 계층 순서로 헤더를 제거한다.

---

### 4.1 Physical → Data Link 계층

- 전기 신호 수신
    
- Frame 단위로 복원
    
- MAC 주소 확인
    

자신의 MAC 주소가 아니라면 프레임은 폐기된다.

---

### 4.2 Network 계층

- IP 주소 확인
    
- 목적지 IP가 자신이면 상위 계층으로 전달
    

라우터는 **이 계층까지만 처리**하고  
Transport 이상 데이터는 보지 않는다.

---

### 4.3 Transport 계층

- 포트 번호 확인
    
- 어느 프로세스로 전달할지 결정
    
- TCP인 경우 순서 재조합, 누락 검증
    

여기서 처음으로  
“이 데이터는 어떤 애플리케이션용인가”가 결정된다.

---

### 4.4 Application 계층

- 애플리케이션 프로토콜 해석
    
- 사용자 또는 서버 로직으로 전달
    

HTTP, DNS, SSH 등  
비로소 “의미 있는 데이터”로 인식되는 단계다.

---

## 5. 왜 계층별 캡슐화 구조가 중요한가

### 5.1 중간 장비는 모든 계층을 보지 않는다

- 스위치: L2까지만 확인
    
- 라우터: L3까지만 확인
    
- 로드밸런서(L4): 포트까지만 확인
    

이 때문에

- IP는 맞는데 서비스가 안 되는 상황
    
- 포트는 열려 있는데 응답이 없는 상황
    

같은 문제가 발생한다.

---

### 5.2 트러블슈팅 시 계층 분리가 결정적이다

예를 들어,

- MAC 문제 → L2
    
- IP 도달 문제 → L3
    
- 포트 거부 → L4
    
- 인증 실패 → L7
    

캡슐화 구조를 이해하지 못하면  
**모든 문제를 네트워크 문제로 오해**하게 된다.

---

## 6. 실무 관점에서의 핵심 정리

- 각 계층은 자신의 헤더만 처리한다
    
- 하위 계층은 상위 데이터의 의미를 모른다
    
- 문제는 “끊긴 계층”에서 발생한다
    

그래서 실무에서는 항상 이렇게 질문했다.

> “이 데이터는 어디까지 내려갔고,  
> 어디에서 더 이상 올라오지 못했는가?”

이 질문에 답할 수 있다면  
네트워크 트러블슈팅의 절반은 이미 끝난 셈이다.

---

## 7. 캡슐화 / 디캡슐화 한 줄 요약

- **캡슐화**  
    → 데이터를 보내기 위해 계층별로 포장하는 과정
    
- **디캡슐화**  
    → 받은 데이터를 해석하기 위해 계층별로 포장을 푸는 과정