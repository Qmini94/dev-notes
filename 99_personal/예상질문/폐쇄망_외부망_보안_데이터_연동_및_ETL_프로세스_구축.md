## Q1. 폐쇄망과 외부망 연동이 필요했던 배경을 설명해 주세요.

클라이언트의 조직 정보, 회계 데이터 같은 핵심 데이터가 보안상 폐쇄망에 격리되어 있었습니다. 그런데 외부망에서 운영되는 CMS 서비스에서 이 데이터를 활용해야 하는 요구사항이 있었습니다. 예를 들어 조직도 기반의 게시판 접근 제어나, 회계 데이터를 활용한 콘텐츠 표시 같은 기능이 필요했는데, 폐쇄망 데이터에 직접 접근할 수 없으니 수동으로 데이터를 이관하고 있었습니다. 이게 운영 부담도 크고 데이터 정합성 유지도 어려워서, 자동화된 연동 파이프라인을 구축하게 되었습니다.

---

## Q2. 폐쇄망과 외부망 사이의 통신은 어떻게 구성했나요?

폐쇄망에서 외부망으로 직접 DB 접근은 불가능한 환경이었기 때문에, 폐쇄망 측에서 제공하는 API를 통해 데이터를 수신하는 구조를 채택했습니다. 통신 보안은 인증서 기반 암복호화 방식으로 처리했습니다. 외부망 서버가 인증서를 사용해서 폐쇄망 API에 인증하고, 전송 구간은 암호화되어 데이터가 평문으로 노출되지 않습니다. 폐쇄망 API가 제공하는 데이터 형식과 외부망 DB의 스키마가 다르기 때문에, 수신한 데이터를 그대로 쓸 수는 없고 변환 과정이 필수적이었습니다.

---

## Q3. ETL 프로세스의 각 단계를 구체적으로 설명해 주세요.

Extract 단계에서는 폐쇄망 API를 호출해서 조직, 회계 등의 원천 데이터를 수신합니다. 스케줄러가 주기적으로 실행되어 변경된 데이터를 가져오는 방식입니다. Transform 단계에서는 이기종 시스템 간 스키마 차이를 처리합니다. 폐쇄망 시스템의 코드 체계, 날짜 형식, 필드 구조가 외부망 DB와 다르기 때문에 코드 매핑, 형식 변환, 데이터 정제를 수행합니다. 예를 들어 부서 코드 체계가 다르면 매핑 테이블을 기반으로 변환합니다. Load 단계에서는 변환된 데이터를 외부망 DB에 적재합니다. 신규 데이터는 INSERT하고, 변경된 데이터는 UPDATE하는 upsert 방식으로 처리합니다.

---

## Q4. 이기종 시스템 간 스키마 차이는 어떤 것들이 있었나요?

여러 가지가 있었는데, 대표적으로 세 가지입니다. 첫째, 코드 체계가 달랐습니다. 폐쇄망에서 부서를 식별하는 코드와 외부망에서 사용하는 코드가 다르기 때문에 매핑 테이블을 만들어서 변환해야 했습니다. 둘째, 날짜와 숫자의 형식이 달랐습니다. 폐쇄망 시스템은 문자열로 날짜를 내려주는 경우가 있었는데, 외부망 DB에서는 날짜 타입으로 저장해야 하니까 파싱과 변환이 필요했습니다. 셋째, 데이터 구조 자체가 달라서 폐쇄망에서는 하나의 필드에 담긴 정보를 외부망에서는 여러 컬럼으로 분리해서 저장해야 하는 경우도 있었습니다.

---

## Q5. 데이터 정합성은 어떻게 보장했나요?

몇 가지 장치를 두었습니다. 첫째, 변경 감지 기반으로 동작합니다. 매번 전체 데이터를 다시 가져오는 게 아니라, 폐쇄망 API에서 변경 시각이나 버전 정보를 기준으로 변경분만 가져옵니다. 둘째, 적재할 때 upsert 방식을 쓰기 때문에 같은 데이터가 중복 적재되어도 최신 상태가 유지됩니다. 셋째, ETL 실행 이력과 처리 건수를 로깅해서, 예상 건수와 실제 처리 건수를 비교할 수 있도록 했습니다. 차이가 발생하면 알 수 있게 해두었고, 필요하면 특정 시점 기준으로 전체 재동기화도 가능한 구조입니다.

---

## Q6. ETL 프로세스의 실행 주기와 스케줄링은 어떻게 관리했나요?

Spring의 스케줄러를 활용해서 데이터 유형별로 실행 주기를 다르게 설정했습니다. 조직 정보처럼 변경 빈도가 낮은 데이터는 하루에 한두 번 정도 동기화하고, 좀 더 자주 변경되는 데이터는 주기를 짧게 가져갔습니다. 스케줄러가 실행될 때마다 이전 동기화 시점 이후의 변경분을 가져오는 방식이라, 한 번에 처리하는 데이터 양을 관리 가능한 수준으로 유지할 수 있었습니다. 수동 트리거도 가능하게 해둬서, 긴급하게 데이터를 맞춰야 할 때는 관리자가 즉시 동기화를 실행할 수 있습니다.

---

## Q7. 인증서 기반 통신에서 인증서 만료나 갱신은 어떻게 처리했나요?

인증서에는 유효 기간이 있기 때문에 만료 전에 갱신해야 합니다. 인증서 만료일을 모니터링해서 만료가 임박하면 미리 알림이 가도록 했습니다. 갱신된 인증서는 서버 설정에 반영하고, ETL 프로세스를 재시작하면 새 인증서로 통신합니다. 인증서가 만료되거나 유효하지 않으면 폐쇄망 API 호출 자체가 실패하는데, 이때 ETL 프로세스는 에러를 로깅하고 다음 스케줄에서 재시도합니다. 인증서 문제로 인한 실패는 데이터 유실이 아니라 지연이 되는 것이고, 인증서가 갱신되면 다음 실행에서 밀린 변경분을 한꺼번에 가져옵니다.

---

## Q8. ETL 실행 중 오류가 발생하면 어떻게 되나요?

단계별로 다르게 처리합니다. Extract 단계에서 API 호출이 실패하면 해당 실행을 중단하고 로그를 남깁니다. 네트워크 일시 장애일 수 있으니까 다음 스케줄에서 재시도합니다. Transform 단계에서 특정 레코드의 변환이 실패하면, 해당 레코드만 건너뛰고 나머지는 계속 처리합니다. 실패한 레코드는 별도로 기록해두었다가 원인을 파악한 뒤 재처리합니다. Load 단계에서 DB 적재가 실패하면 트랜잭션 단위로 롤백됩니다. 전체 프로세스가 하나의 레코드 실패 때문에 멈추지 않도록, 가능한 한 부분 실패를 허용하면서 전체 처리는 계속되게 설계했습니다.

---

## Q9. 이 구조에서 개선하고 싶은 점이 있다면 무엇인가요?

두 가지를 개선하고 싶습니다. 첫째, 현재 폴링 기반으로 변경분을 가져오는 방식인데, 폐쇄망 측에서 이벤트 기반 알림을 지원해주면 변경 감지 지연을 더 줄일 수 있을 것입니다. 다만 이건 폐쇄망 시스템의 협조가 필요한 부분이라 현실적인 제약이 있습니다. 둘째, 매핑 테이블 관리가 현재 수동인데, 폐쇄망 코드 체계가 변경되었을 때 매핑을 자동으로 감지하고 알려주는 체계를 만들면 운영 실수를 줄일 수 있다고 생각합니다. 이런 개선을 통해 데이터 연동의 실시간성과 운영 안정성을 한 단계 더 높일 수 있을 것입니다.